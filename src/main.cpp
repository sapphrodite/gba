#include "common/integral_types.h"
#include "common/register_types.h"

#include "mmio/display.h"
#include "mmio/palette.h"
#include "mmio/buttons.h"
#include "mmio/object.h"

const u8 bun_tiles[128] = {
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x22, 0x22,
    0x00, 0x20, 0x32, 0x24,
    0x00, 0x20, 0x43, 0x24,
    0x20, 0x22, 0x43, 0x22,
    0x22, 0x44, 0x44, 0x02,
    0x42, 0x16, 0x44, 0x22,
    0x42, 0x11, 0x45, 0x24,

    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00,
    0x22, 0x02, 0x00, 0x00,

    0x42, 0x55, 0x54, 0x42,
    0x22, 0x66, 0x22, 0x44,
    0x20, 0x22, 0x44, 0x44,
    0x20, 0x45, 0x44, 0x53,
    0x20, 0x56, 0x35, 0x44,
    0x20, 0x62, 0x34, 0x44,
    0x00, 0x22, 0x36, 0x22,
    0x00, 0x20, 0x22, 0x02,

    0x54, 0x22, 0x22, 0x00,
    0x33, 0x43, 0x24, 0x02,
    0x55, 0x45, 0x44, 0x22,
    0x25, 0x54, 0x45, 0x26,
    0x22, 0x44, 0x44, 0x26,
    0x42, 0x44, 0x33, 0x22,
    0x22, 0x56, 0x23, 0x02,
    0x20, 0x22, 0x22, 0x00,
};

const u16 bun_pal[6] = {
    0x1D09, 0x254C, 0x31D1, 0x3A36, 0x4699, 0x633C
};

int main() {
    auto& obj1 = objects::get(0);
    obj1.set_position(53, 69);
    obj1.set_size(object_size::_16x16);
    for (int i = 1; i < 128; i++) {
        objects::get(i).disable();
    }

    for (int i = 0; i < 6; i++) {
        sprite_palette::get(i + 1).set(bun_pal[i]);
    }

    volatile u16* foo = (u16*)0x06010000;
    u16* dst = (u16*) bun_tiles;
    for (int i = 0; i < 128; i++) {
        foo[i] = dst[i];
    }

    display::bg_mode::set(0);
    display::force_blank::set(false);
    display::active_layers::set(display::layer::OBJ);
    display::obj_mapping::set(display::obj_mapping_mode::_1d);

    while(!button_states::get(button::RIGHT)) {}

    return 0;
}
